select stock_name as stock_name, sum(stock_price) as capital_gain_loss
from (
select stock_name, case when operation='Buy' then -price 
                  else price end as stock_price
from stocks) a 
group by a.stock_name;
